<div class="container mx-auto p-4">
  <h1 class="text-2xl font-bold mb-6">Manage Orders</h1>

  <div class="mb-6 flex gap-2">
    <button
      class="btn"
      (click)="filterOrders('all')"
      [class.btn-primary]="statusFilter === 'all'"
      [class.btn-outline]="statusFilter !== 'all'"
    >
      All Orders
    </button>
    <button
      class="btn"
      (click)="filterOrders('pending')"
      [class.btn-warning]="statusFilter === 'pending'"
      [class.btn-outline]="statusFilter !== 'pending'"
    >
      Pending
    </button>
    <button
      class="btn"
      (click)="filterOrders('accepted')"
      [class.btn-success]="statusFilter === 'accepted'"
      [class.btn-outline]="statusFilter !== 'accepted'"
    >
      Accepted
    </button>
    <button
      class="btn"
      (click)="filterOrders('rejected')"
      [class.btn-error]="statusFilter === 'rejected'"
      [class.btn-outline]="statusFilter !== 'rejected'"
    >
      Rejected
    </button>
  </div>

  <div class="overflow-x-auto bg-base-100 rounded-lg shadow">
    <table class="table">
      <thead>
        <tr>
          <th>Order ID</th>
          <th>Customer</th>
          <th>Date</th>
          <th>Products</th>
          <th>Total</th>
          <th>Status</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        @if (loading){
        <tr>
          <td colspan="7" class="text-center">
            <span class="loading loading-spinner loading-lg"></span>
          </td>
        </tr>
        } @for (order of filteredOrders; track order.id){
        <tr
          class="hover"
          [class.bg-amber-50]="order.status === 'pending'"
          [class.bg-emerald-50]="order.status === 'accepted'"
          [class.bg-rose-50]="order.status === 'rejected'"
        >
          <td>#{{ order.id.slice(0, 8) }}</td>
          <td>{{ order.username }}</td>
          <td>{{ order.date }}</td>
          <td>
            <div class="flex flex-col">
              @for (item of order.items;track item.productId){
              <span>{{ item.title }} (x{{ item.quantity }})</span>
              }
            </div>
          </td>
          <td class="font-medium">{{ order.totalPrice | currency }}</td>
          <td>
            <span>{{ order.status | titlecase }}</span>
          </td>
          <td>
            @if (order.status==='pending'){
            <div>
              <button
                class="btn bg-emerald-600 hover:bg-emerald-700 text-white btn-sm"
                (click)="updateOrderStatus(order.id, 'accepted')"
              >
                Accept
              </button>
              <button
                class="btn bg-rose-600 hover:bg-rose-700 text-white btn-sm"
                (click)="updateOrderStatus(order.id, 'rejected')"
              >
                Reject
              </button>
            </div>
            }@else {
            <span class="text-gray-500">Processed</span>
            }
          </td>
        </tr>
        }@empty { @if(!loading){
        <tr>
          <td colspan="7" class="text-center text-gray-500">No Orders found</td>
        </tr>
        } }
      </tbody>
    </table>
  </div>
</div>
